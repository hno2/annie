{% macro stars(percentage) -%}
<div class="star-rating" title="{{percentage}}%">
    <div class="back-stars">
        <i class="fa fa-star" aria-hidden="true"></i>
        <i class="fa fa-star" aria-hidden="true"></i>
        <i class="fa fa-star" aria-hidden="true"></i>
        <i class="fa fa-star" aria-hidden="true"></i>
        <i class="fa fa-star" aria-hidden="true"></i>

        <div class="front-stars" style="width: {{percentage}}%">
            <i class="fa fa-star" aria-hidden="true"></i>
            <i class="fa fa-star" aria-hidden="true"></i>
            <i class="fa fa-star" aria-hidden="true"></i>
            <i class="fa fa-star" aria-hidden="true"></i>
            <i class="fa fa-star" aria-hidden="true"></i>
        </div>
    </div>
</div>

{%- endmacro %}
{% macro flash_message() -%}
{% with messages = get_flashed_messages() %}
{% if messages %}
{% for message in messages %}
<div class="alert alert-success" role="alert">{{ message }}</div>
{% endfor %}
{% endif %}
{% endwith %}
{%- endmacro %}

{% macro showcase_block(showcases) -%}
{%if not showcases%}
Sorry there are no Showcases yet.
{%else%}
<div class="card-group">
    {% for showcase in showcases %}
    {{showcase_identity(showcase)}}
    {%endfor%}
</div>
{%endif%}

{%- endmacro %}

{% macro showcase_identity(showcase,editable=false, linked=true, comments=false) -%}
<!-- comments: False - Do not display comments, None: No comments to display or [list] of comments to display-->
<div class="card" id="{{showcase.id}}">
    <div class="card-body" style="position:relative">
        {% if linked %}
        <a href="/review/{{showcase.submission.filepath}}" class="stretched-link"></a>
        {% endif %}
        <h5 class="card-title">{{showcase.name}}</h5>
        <p class="card-text">
            {{showcase.description}}
        </p>
    </div>
    <div class="card-footer">
        {%for tag in showcase.tags%}
        {% if linked %}
        <a href="?filtered_by={{tag}}" class="badge rounded-pill bg-secondary">{{tag}}</a>
        {% else %}
        <span class="badge rounded-pill bg-secondary">{{tag}}</span>
        {% endif %}
        {%endfor%}
        <div class="btn-wrapper text-center d-flex justify-content-between">
            <small class="text-muted">{{showcase.created|timeago}}</small>
            <p class="upvote {{'text-primary' if user in showcase.voted_users else 'pointer'}}"><span class="far fa-thumbs-up"></span><span class="score">{{showcase.score}}</span></p>

        </div>
    </div>
    {%if comments is not false%}
    <div class="card-footer bg-light">

        <!-- Do not display add comments-->
        {%if comments is not none%}
        {%for comment in comments%}
        {{comment_block(comment)}}
        {%endfor%}
        {%endif%}
        <div class="form-outline">
            <input class="form-control comment-box" id="comment"></input>
            <label class="form-label" for="comment">+ Add your comment</label>
        </div>
        <small>
            <div class="float-right">
                <span role="button" class="post"> Post <i class="fas fa-level-down-alt fa-rotate-90"></i></span></div>
            <span class="text-muted description">
                Comments support `inline code`, ```code blocks```, **bold** and _italic_ formatting</span>
        </small>
    </div>
    {%endif%}
</div>

{%- endmacro %}

{%- macro comment_block(comment)%}
<div class="d-flex flex-start align-items-center">
    <img class="rounded-circle shadow-1-strong me-3" src="https://mdbootstrap.com/img/Photos/Avatars/img%20(19).jpg" alt="avatar" width="60" height="60" />
    <div>
        <h6 class="fw-bold mb-1">{{comment.user.username}}</h6>
        <p class="text-muted small mb-0">
            {{comment.created|timeago}}
        </p>
    </div>
</div>

<p class="mt-3 mb-4 pb-2">
    {{comment.html|safe}}
</p>
{%- endmacro %}


{% macro grade_block(grade,threshold=50) -%}

{% set mapping = {"Success": "bg-success", "In Progress": "bg-info", "Failed":"bg-warning"} -%}

{%if grade%}
{%if grade.overall>50%}
{%set status="Success"%}
{%else%}
{%set status="Failed"%}
{%endif%}
{%else%}
{%set status="In Progress"%}
{%endif%}

<span class="badge {{mapping[status]}}">{{status}}
    {%if grade%}
    <span class="badge bg-light text-dark ms-2">{{grade.overall}}/100</span>
    <span class="visually-hidden">grade</span></span>
{%endif%}
{%- endmacro %}
{% macro task_card(name, description,repository, submissions) -%}
<div class="card">
    <h5 class="card-header d-flex justify-content-between align-items-center">{{name}}
        {{grade_block(submissions[0].grade) if submissions}}</h5>
    <div class="card-body">
        <p class="card-text">
            {{description}}
            {%if submissions %}
            <hr>
            <a href="/review/{{submissions[0].filepath}}" class="btn btn-primary">Review Submission</a>
            {%endif%}
        </p>
        <a href="https://colab.research.google.com/github/{{repository}}" target="_blank"><span class="badge bg-warning text-dark">
                <i class="fas fa-infinity"></i> Open in Colab</span></a>
        <a href="https://www.github.com/{{repository}}" target="_blank"><span class="badge bg-success ms-2 me-5"><i class="fas fa-download fa-lg"></i>
                Download</span></a>
    </div>
    <div class="card-footer text-muted">
        You can either submit your solution directly from Colab or
        <!-- Buttons trigger collapse -->
        <a data-mdb-toggle="collapse" href="#upload-{{name|replace(' ' ,'')}}" role="button" aria-expanded="false" aria-controls="upload-{{name|replace(' ' ,'')}}">
            Upload it here
        </a>
        </p>
        <!-- Collapsed content -->
        <div class="collapse mt-3" id="upload-{{name|replace(' ' ,'')}}">
            {{ dropzone.create(id=name, action="/upload/"+name) }}
        </div>
    </div>

</div>
<br>
{%- endmacro %}


{% macro grade_ring(percentage, name="") -%}
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 110 110">
    <style>
        svg {
            height: 120px;
        }

        path {
            stroke-linecap: round;
            stroke-width: 2;
        }

        .bottom {
            stroke: lightgrey;
        }
    </style>
    <defs>
        <path id="thePath" d="M40,90
A40,40 0 1,1 70,90" style="fill:none;" />
    </defs>
    <use xlink:href="#thePath" id="base" class="bottom" />
    <use xlink:href="#thePath" id="slider" class="top" style="stroke: {{'#FFA900' if percentage<30 else '#1266F1'}};
            stroke-dasharray: 220;
            stroke-dashoffset: {{220-percentage*2.2}};" />

    <text id="theText" x="50%" y="50%" dominant-baseline="middle" text-anchor="middle">
        <tspan dy="-0.7em">{{percentage}}%</tspan>
        <tspan dy="1.2em" x="50%">{{name}}</tspan>
    </text>
</svg> {%- endmacro %}
{%macro gradeblock(grade) -%}
{%if grade.overall%}
{{grade_ring(grade.overall, "Overall")}}
{%endif%}
{%if grade.ai%}
{{grade_ring(grade.ai, "AI")}}
{%endif%}
{%if grade.static%}
{{grade_ring(grade.static, "Static")}}
{%endif%}
{%if grade.peer%}
{{grade_ring(grade.peer, "Peer")}}
{%endif%}
{%- endmacro%}